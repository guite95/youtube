name: Build Installer

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

permissions:
  contents: write
  actions: read

jobs:
  build-installer:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: Build executable
      run: |
        pyinstaller --onefile --noconsole --icon="icon.ico" youtube_to_mp3.py
        
    - name: Install Chocolatey
      run: |
        Set-ExecutionPolicy Bypass -Scope Process -Force
        [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
        iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
        
    - name: Install NSIS via Chocolatey
      run: |
        choco install nsis -y
        
    - name: Build installer
      run: |
        makensis installer.nsi
        
    - name: Upload installer artifact
      uses: actions/upload-artifact@v4
      with:
        name: YouTube_to_MP3_Converter_Setup
        path: YouTube_to_MP3_Converter_Setup.exe
        
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: YouTube_to_MP3_Converter_Setup.exe
        draft: false
        prerelease: false
        generate_release_notes: false
        body: |
          ## ğŸµ YouTube to MP3 Converter v${{ github.ref_name }}
          
          ### âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥
          - ğŸ“ **íŒŒì¼ ì´ë¦„ ì§€ì • ê¸°ëŠ¥**: ì›í•˜ëŠ” íŒŒì¼ ì´ë¦„ìœ¼ë¡œ ì €ì¥ ê°€ëŠ¥
          - ğŸš€ **ì„¤ì¹˜ í”„ë¡œê·¸ë¨**: ê°„í¸í•œ ì„¤ì¹˜ ê³¼ì •
          - ğŸ”„ **ìë™ ì—…ë°ì´íŠ¸**: í”„ë¡œê·¸ë¨ ë‚´ì—ì„œ ìµœì‹  ë²„ì „ í™•ì¸
          
          ### ğŸ“¥ ì„¤ì¹˜ ë°©ë²•
          1. **`YouTube_to_MP3_Converter_Setup.exe`** íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”
          2. ì„¤ì¹˜ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ì„¸ìš”
          3. ì„¤ì¹˜ ì™„ë£Œ í›„ ì‹œì‘ ë©”ë‰´ì—ì„œ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ì„¸ìš”
          
          ### ğŸ“– ì‚¬ìš©ë²•
          1. **YouTube URL ì…ë ¥**: ë³€í™˜í•˜ê³  ì‹¶ì€ YouTube ë™ì˜ìƒì˜ URLì„ ì…ë ¥í•˜ì„¸ìš”
          2. **íŒŒì¼ ì´ë¦„ ì§€ì •** (ì„ íƒì‚¬í•­): ì›í•˜ëŠ” íŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”. ë¹„ì›Œë‘ë©´ ë™ì˜ìƒ ì œëª©ì„ ì‚¬ìš©í•©ë‹ˆë‹¤
          3. **ì €ì¥ ê²½ë¡œ ì„ íƒ**: MP3 íŒŒì¼ì„ ì €ì¥í•  í´ë”ë¥¼ ì„ íƒí•˜ì„¸ìš”
          4. **ë‹¤ìš´ë¡œë“œ**: ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë³€í™˜ì„ ì‹œì‘í•˜ì„¸ìš”
          
          ### ğŸ’» ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­
          - Windows 10 ì´ìƒ
          - ì¸í„°ë„· ì—°ê²°
          - FFmpeg (ìë™ ì„¤ì¹˜ë¨)
          
          ### ğŸ”— ê´€ë ¨ ë§í¬
          - [ğŸ“– ì‚¬ìš©ë²• ê°€ì´ë“œ](https://github.com/guite95/youtube#-ì‚¬ìš©ë²•)
          - [ğŸ› ì´ìŠˆ ë¦¬í¬íŠ¸](https://github.com/guite95/youtube/issues)
          - [â­ ìŠ¤íƒ€ ëˆŒëŸ¬ì£¼ì„¸ìš”](https://github.com/guite95/youtube/stargazers)
          
          ---
          
          **â­ ì´ í”„ë¡œì íŠ¸ê°€ ë„ì›€ì´ ë˜ì—ˆë‹¤ë©´ ìŠ¤íƒ€ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!**
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 